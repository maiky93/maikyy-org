<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <style>
        body {
            margin: 0;
            background: #eee;
        }
        #display-area {
            width: 768px;
            height: 512px;
            background: black;
            position: absolute;
            top: 0;
            left: 0;
            border: 1px solid red;
            position: relative;
            overflow: hidden;
        }
        #background-gif {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        #background-video {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        #clock, #date, #weather {
            color: white;
            font-family: Arial, Helvetica, sans-serif;
            position: absolute;
            left: 10px;
            z-index: 2;
            text-shadow:
                1px 1px 0 #000,
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                0 1px 0 #000,
                1px 0 0 #000,
                0 -1px 0 #000,
                -1px 0 0 #000;
        }
        #clock {
            bottom: 125px;
            font-size: 42px;
        }
        #date {
            bottom: 170px;
            font-size: 32px;
        }
        #weather {
            bottom: 80px;
            font-size: 32px;
        }
        #schedule {
            position: absolute;
            bottom: 5px;
            left: 5px;
            width: 98%;
            height: 70px;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2;
            color: white;
            font-family: Arial, Helvetica, sans-serif;
            display: flex;
            flex-direction: column;
            padding: 5px;
            box-sizing: border-box;
        }
        .schedule-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 20px;
        }
        .schedule-label {
            font-weight: bold;
            margin-right: 10px;
            width: 100px;
        }
        .activity-block {
            padding: 5px 10px;
            border-radius: 4px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div id="display-area">
        <img id="background-gif" src="https://github.com/maiky93/maikyy-org/blob/main/media/gifs/winter-2540.gif?raw=true" alt="background animation">
        
        <!--video id="background-video" autoplay loop muted playsinline>
            <source src="your-video-file.mp4" type="video/mp4">
        </video-->

        <div id="date"></div>
        <div id="clock"></div>
        <div id="weather"></div>
        <div id="schedule">
            <div class="schedule-item">
                <span class="schedule-label">Huidig:</span>
                <span id="current-activity"></span>
            </div>
            <div class="schedule-item">
                <span class="schedule-label">Hierna:</span>
                <span id="next-activity"></span>
            </div>
        </div>
    </div>
    <script>
        const API_KEY = 'f0436ea441ee727e737ca8ad122414f4';
        const CITY = 'Leiden';
        const COUNTRY = 'NL';

        // Activity names and colors
        const activityDetails = {
            0: { name: "Openen", color: '#8cc5ff' },
            1: { name: "Afsluiten", color: '#8affb7' },
            2: { name: "Publiek", color: '#666666' },
            3: { name: "Dweilen", color: '#ff5b0d' },
            4: { name: "Beschikbaar", color: '#ffff00' },
            5: { name: "SchaatsSchool", color: '#5f60fe' },
            6: { name: "Curling Optie", color: '#ffff00' },
            7: { name: "IJVL", color: '#15de00' },
            8: { name: "JSC", color: '#78ffe0' },
            9: { name: "V5", color: '#c7ff8d' },
            10: { name: "Leiden Lions", color: '#fea971' },
            11: { name: "Patch ijs", color: '#f7d488' },
            12: { name: "KSVRijnland", color: '#0fe3ff' },
            13: { name: "IHCL", color: '#ff63dd' },
            14: { name: "Ter aar/Leim/Rijnst", color: '#eb663d' },
            15: { name: "Wedstrijden", color: '#00ffff' },
            16: { name: "Gezins Schaatsen", color: '#028000' },
            17: { name: "Oegstgeest", color: '#00ff00' }
        };

        async function fetchSchedule() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/maiky93/maikyy-org/main/data/data.json');
                const data = await response.json();
                return data['Cleaning Schedule'];
            } catch (error) {
                console.error('Error fetching schedule:', error);
                return null;
            }
        }

        function getCurrentDayName() {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayIndex = new Date().getDay();
            return days[dayIndex];
        }

        function parseTime(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            const date = new Date();
            date.setHours(hours, minutes, 0, 0);
            return date;
        }

        async function updateSchedule() {
            const schedule = await fetchSchedule();
            if (!schedule) return;

            const now = new Date();
            const currentHours = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTimeInMinutes = currentHours * 60 + currentMinutes;

            const dayName = getCurrentDayName();
            const daySchedule = schedule[dayName]?.Hockeybaan || [];

            console.log('Current time in minutes:', currentTimeInMinutes);

            let currentActivity = null;
            let nextActivity = null;

            for (let i = 0; i < daySchedule.length; i++) {
                const [startTime, endTime, activityType] = daySchedule[i];
                
                // Convert schedule times to minutes
                const [startHour, startMinute] = startTime.split(':').map(Number);
                const [endHour, endMinute] = endTime.split(':').map(Number);
                const startTimeInMinutes = startHour * 60 + startMinute;
                const endTimeInMinutes = endHour * 60 + endMinute;

                console.log(`Checking slot: ${startTime}-${endTime} (${startTimeInMinutes}-${endTimeInMinutes})`);

                if (currentTimeInMinutes >= startTimeInMinutes && currentTimeInMinutes < endTimeInMinutes) {
                    currentActivity = {
                        type: activityType,
                        endTime: endTime
                    };
                    if (i < daySchedule.length - 1) {
                        nextActivity = {
                            type: daySchedule[i + 1][2],
                            startTime: daySchedule[i + 1][0]
                        };
                    }
                    break;
                }
            }

            // Update display
            const currentElement = document.getElementById('current-activity');
            const nextElement = document.getElementById('next-activity');

            if (currentActivity) {
                const activity = activityDetails[currentActivity.type] || { name: "Onbekend", color: "#cccccc" };
                currentElement.innerHTML = `<span class="activity-block" style="background-color: ${activity.color}">${activity.name}</span> tot ${currentActivity.endTime}`;
            } else {
                currentElement.textContent = "Geen activiteit";
            }

            if (nextActivity) {
                const activity = activityDetails[nextActivity.type] || { name: "Onbekend", color: "#cccccc" };
                nextElement.innerHTML = `<span class="activity-block" style="background-color: ${activity.color}">${activity.name}</span> vanaf ${nextActivity.startTime}`;
            } else {
                nextElement.textContent = "Geen volgende activiteit";
            }
        }

        async function getWeather() {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${CITY},${COUNTRY}&units=metric&lang=nl&appid=${API_KEY}`);
                const data = await response.json();
                
                const temp = Math.round(data.main.temp);
                const feelsLike = Math.round(data.main.feels_like);
                const description = data.weather[0].description;
                
                document.getElementById('weather').textContent = 
                    `${temp}°C (voelt als ${feelsLike}°C) - ${description}`;
            } catch (error) {
                console.error('Error fetching weather:', error);
                document.getElementById('weather').textContent = '...';
            }
        }

        function updateDateTime() {
            const now = new Date();
            
            const time = now.toLocaleTimeString('nl-NL', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const dateString = now.toLocaleDateString('nl-NL', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            document.getElementById('clock').textContent = time;
            document.getElementById('date').textContent = dateString;
        }
        
        // Initial calls
        updateDateTime();
        getWeather();
        updateSchedule();

        // Set up intervals
        setInterval(updateDateTime, 1000);
        setInterval(getWeather, 1800000); // Update weather every 30 minutes
        setInterval(updateSchedule, 60000); // Update schedule every minute
    </script>
</body>
</html>